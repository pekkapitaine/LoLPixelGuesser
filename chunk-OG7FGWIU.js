import{a as q,b as Q,c as Y}from"./chunk-YVZU3IOO.js";import{a as K}from"./chunk-7E6LTSF4.js";import{d as U}from"./chunk-MTHWXV2K.js";import{B as S,D as I,E as b,G as E,H as D,I as H,J as P,K as k,L as i,M as o,N as M,O as T,P as u,Q as w,S as j,T as R,U as B,V as a,W as v,X as x,Y as z,c as h,fa as $,i as G,ia as A,ka as N,l as y,n as p,o as m,s as g,t as L,u as c,x as V}from"./chunk-CDHMGMKZ.js";var O=class s{gameData=null;championsList=[];loadGameData(){return h(this,null,function*(){if(this.gameData)return;let e=yield fetch("game_data.json");this.gameData=yield e.json()})}loadChampionsList(){return h(this,null,function*(){if(this.championsList.length)return this.championsList;let e=yield fetch("champions_list.json");return this.championsList=yield e.json(),this.championsList})}getChampionsList(){return this.championsList}getFilteredImages(e){let t=this.gameData?.images??[];return e?t:t.filter(n=>n.category==="default")}getRandomImage(e){let t=this.getFilteredImages(e);return t.length?t[Math.floor(Math.random()*t.length)]:null}getImagePath(e){return`ImagesChamps/${e.category==="skin"?"SkinChamps":"DefaultChamps"}/${e.file}`}pixelizeImage(e,t){return h(this,null,function*(){let n=Q[t],r=new Image;r.src=e,yield new Promise((X,Z)=>{r.onload=()=>X(),r.onerror=()=>Z(`Erreur chargement image: ${e}`)});let l=document.createElement("canvas"),d=l.getContext("2d"),_=Math.max(1,Math.floor(r.width/n)),C=Math.max(1,Math.floor(r.height/n));l.width=_,l.height=C,d.imageSmoothingEnabled=!1,d.drawImage(r,0,0,_,C);let f=document.createElement("canvas");f.width=r.width,f.height=r.height;let F=f.getContext("2d");return F.imageSmoothingEnabled=!1,F.drawImage(l,0,0,_,C,0,0,r.width,r.height),f.toDataURL()})}filterSuggestions(e){if(!e.trim())return[];let t=e.toLowerCase().trim();return this.championsList.filter(r=>r.toLowerCase().includes(t)).sort((r,l)=>{let d=r.toLowerCase(),_=l.toLowerCase(),C=d.startsWith(t),f=_.startsWith(t);return C&&!f?-1:!C&&f?1:d.localeCompare(_)})}normalizeStr(e){return String(e||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").replace("_"," ").trim().toLowerCase()}static \u0275fac=function(t){return new(t||s)};static \u0275prov=G({token:s,factory:s.\u0275fac,providedIn:"root"})};var ee=["champInput"];function te(s,e){s&1&&M(0,"div",17)}function ne(s,e){if(s&1&&M(0,"img",18),s&2){let t=w();I("src",t.champImageSrc(),L)}}function ie(s,e){if(s&1&&(i(0,"li"),a(1),o()),s&2){let t=e.$implicit;b("correct",t.correct)("wrong",!t.correct),c(),z(" ",t.correct?"\u2705":"\u274C"," ",t.champion," ")}}function oe(s,e){if(s&1){let t=T();i(0,"div",35),u("click",function(){let r=p(t).$implicit,l=w(2);return m(l.selectSuggestion(r))}),a(1),o()}if(s&2){let t=e.$implicit,n=e.$index,r=w(2);b("focused",n===r.focusedIndex()),c(),v(t)}}function re(s,e){if(s&1&&(i(0,"div",26),P(1,oe,2,3,"div",34,H),o()),s&2){let t=w();c(),k(t.suggestions())}}function ae(s,e){if(s&1&&(i(0,"li"),a(1),o()),s&2){let t=e.$implicit;b("correct",t.correct)("wrong",!t.correct),c(),z(" ",t.correct?"\u2705":"\u274C"," ",t.champion," ")}}var W=class s{route=y(A);router=y(N);gameService=y(q);championService=y(O);timer=y(K);difficulty=g("facile");difficultyTitle=$(()=>Y[this.difficulty()].label);champImageSrc=g("");feedback=g("none");inputValue=g("");suggestions=g([]);focusedIndex=g(0);isLoading=g(!0);history=this.gameService.history;stats=this.timer.stats;formattedTime=this.timer.formattedTime;ratio=this.timer.ratio;showHistory=g(!1);currentChampion=null;currentSoluce=null;feedbackTimeout=null;champInputRef;ngOnInit(){return h(this,null,function*(){let e=this.route.snapshot.paramMap.get("difficulty");this.difficulty.set(e??"facile"),this.gameService.setDifficulty(this.difficulty()),this.gameService.resetHistory(),yield Promise.all([this.championService.loadGameData(),this.championService.loadChampionsList()]),this.timer.start(),yield this.loadNextChamp()})}ngOnDestroy(){this.timer.stop(),this.feedbackTimeout&&clearTimeout(this.feedbackTimeout)}toggleHistory(){this.showHistory.update(e=>!e)}goBack(){this.timer.stop(),this.router.navigate(["/"])}loadNextChamp(){return h(this,null,function*(){this.isLoading.set(!0);try{let e=this.championService.getRandomImage(this.gameService.includeSkins());if(!e)return;let t=this.championService.getImagePath(e),n=yield this.championService.pixelizeImage(t,this.difficulty());this.champImageSrc.set(n),this.currentChampion=e.champion,this.currentSoluce=t}catch(e){console.error("Erreur chargement champion :",e)}finally{this.isLoading.set(!1)}})}skip(){this.loadNextChamp()}onInputChange(e){this.inputValue.set(e);let t=this.championService.filterSuggestions(e);this.suggestions.set(t),this.focusedIndex.set(0)}onKeydown(e){let t=this.suggestions();if(t.length){if(e.key==="ArrowDown")e.preventDefault(),this.focusedIndex.update(n=>(n+1)%t.length);else if(e.key==="ArrowUp")e.preventDefault(),this.focusedIndex.update(n=>(n-1+t.length)%t.length);else if(e.key==="Enter"){e.preventDefault();let n=t[this.focusedIndex()];n&&this.selectSuggestion(n)}}}selectSuggestion(e){this.inputValue.set(""),this.suggestions.set([]),this.submitGuess(e)}submitGuess(e){if(!e.trim()||!this.currentChampion)return;this.timer.incrementAttempts();let t=this.championService.normalizeStr(e),n=this.championService.normalizeStr(this.currentChampion);t===n?(this.timer.incrementCorrect(),this.gameService.addHistory({champion:this.currentChampion,correct:!0}),this.showFeedback("correct"),this.currentSoluce&&this.champImageSrc.set(this.currentSoluce),this.feedbackTimeout=setTimeout(()=>{this.feedback.set("none"),this.loadNextChamp()},1e3)):(this.timer.resetStreak(),this.gameService.addHistory({champion:e,correct:!1}),this.showFeedback("wrong"),this.feedbackTimeout=setTimeout(()=>{this.feedback.set("none")},2e3))}showFeedback(e){this.feedbackTimeout&&clearTimeout(this.feedbackTimeout),this.feedback.set(e)}static \u0275fac=function(t){return new(t||s)};static \u0275cmp=V({type:s,selectors:[["app-game"]],viewQuery:function(t,n){if(t&1&&j(ee,5),t&2){let r;R(r=B())&&(n.champInputRef=r.first)}},decls:73,vars:23,consts:[["champInput",""],[1,"container"],[1,"top-bar"],[1,"back-btn",3,"click"],["src","assets/interface/back_arrow.svg","alt","Retour"],[1,"mode-title"],[1,"stats-inline"],[1,"game-area"],[1,"side-panel","stats-panel"],[1,"timer-block"],[1,"timer-label"],[1,"timer-value"],[1,"stats-block"],[1,"stat-row"],[1,"stat-label"],[1,"stat-value"],[1,"image-container"],[1,"loader-spinner"],["alt","Champion Pixelis\xE9",3,"src"],[1,"feedback"],[1,"side-panel","history-panel"],[1,"history"],[3,"correct","wrong"],[1,"bottom-controls"],[1,"guess"],["type","text","placeholder","Tape le nom du champion...","autocomplete","off",3,"input","keydown","value"],[1,"suggestions"],[1,"bottom-actions"],["id","skip-current-champ",3,"click"],[1,"history-btn",3,"click"],[1,"history-drawer"],[1,"drawer-header"],[1,"drawer-close",3,"click"],[1,"drawer-backdrop",3,"click"],[1,"suggestion-item",3,"focused"],[1,"suggestion-item",3,"click"]],template:function(t,n){if(t&1){let r=T();i(0,"div",1)(1,"header",2)(2,"button",3),u("click",function(){return p(r),m(n.goBack())}),M(3,"img",4),o(),i(4,"h2",5),a(5),o(),i(6,"div",6)(7,"span"),a(8),o(),i(9,"span"),a(10),o(),i(11,"span"),a(12),o()()(),i(13,"div",7)(14,"aside",8)(15,"div",9)(16,"div",10),a(17,"\u23F1\uFE0F Temps"),o(),i(18,"div",11),a(19),o()(),i(20,"div",12)(21,"div",13)(22,"span",14),a(23,"\u{1F50D} Tentatives :"),o(),i(24,"span",15),a(25),o()(),i(26,"div",13)(27,"span",14),a(28,"\u2705 Bons :"),o(),i(29,"span",15),a(30),o()(),i(31,"div",13)(32,"span",14),a(33,"\u{1F525} S\xE9rie :"),o(),i(34,"span",15),a(35),o()(),i(36,"div",13)(37,"span",14),a(38,"\u{1F4CA} Ratio :"),o(),i(39,"span",15),a(40),o()()()(),i(41,"div",16),S(42,te,1,0,"div",17)(43,ne,1,1,"img",18),i(44,"div",19),a(45),o()(),i(46,"aside",20)(47,"div",21)(48,"h3"),a(49,"Historique"),o(),i(50,"ul"),P(51,ie,2,6,"li",22,D),o()()()(),i(53,"div",23)(54,"div",24)(55,"input",25,0),u("input",function(d){return p(r),m(n.onInputChange(d.target.value))})("keydown",function(d){return p(r),m(n.onKeydown(d))}),o(),S(57,re,3,0,"div",26),o(),i(58,"div",27)(59,"button",28),u("click",function(){return p(r),m(n.skip())}),a(60,"Passer"),o(),i(61,"button",29),u("click",function(){return p(r),m(n.toggleHistory())}),a(62,"\u{1F4CB} Historique"),o()()(),i(63,"div",30)(64,"div",31)(65,"h3"),a(66,"Historique"),o(),i(67,"button",32),u("click",function(){return p(r),m(n.toggleHistory())}),a(68,"\u2715"),o()(),i(69,"ul"),P(70,ae,2,6,"li",22,D),o()(),i(72,"div",33),u("click",function(){return p(r),m(n.toggleHistory())}),o()()}t&2&&(c(5),x("\u267E\uFE0F Mode Infini \u2014 ",n.difficultyTitle(),""),c(3),x("\u23F1\uFE0F ",n.formattedTime(),""),c(2),x("\u2705 ",n.stats().correct,""),c(2),x("\u{1F525} ",n.stats().streak,""),c(7),v(n.formattedTime()),c(6),v(n.stats().attempts),c(5),v(n.stats().correct),c(5),v(n.stats().streak),c(5),x("",n.ratio()," / min"),c(2),E(n.isLoading()?42:43),c(2),b("visible",n.feedback()!=="none")("correct",n.feedback()==="correct")("wrong",n.feedback()==="wrong"),c(),x(" ",n.feedback()==="correct"?"\u2705 Correct !":"\u274C Faux !"," "),c(6),k(n.history()),c(4),I("value",n.inputValue()),c(2),E(n.suggestions().length>0?57:-1),c(6),b("open",n.showHistory()),c(7),k(n.history()),c(2),b("visible",n.showHistory()))},dependencies:[U],styles:["[_nghost-%COMP%]{display:flex;flex:1}.container[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;background:radial-gradient(circle at center,#101820,#05060a);color:#fff;height:100dvh;overflow:hidden;box-sizing:border-box}.top-bar[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:10px 12px;flex-shrink:0;background:#00000080;backdrop-filter:blur(10px);border-bottom:1px solid rgba(248,210,75,.1333333333)}.back-btn[_ngcontent-%COMP%]{flex-shrink:0;padding:7px 10px;background:transparent;border:1px solid #f8d24b;border-radius:10px;color:#f8d24b;cursor:pointer;transition:background .2s ease}.back-btn[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:14px;height:11px;object-fit:contain;display:block}.mode-title[_ngcontent-%COMP%]{flex:1;color:#f8d24b;font-size:.8rem;margin:0;text-align:center;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.stats-inline[_ngcontent-%COMP%]{display:flex;gap:5px;font-size:.78rem;flex-shrink:0}.stats-inline[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:#ffffff14;border-radius:8px;padding:3px 7px}.game-area[_ngcontent-%COMP%]{flex:1;display:flex;align-items:stretch;overflow:hidden}.side-panel[_ngcontent-%COMP%]{display:none}.image-container[_ngcontent-%COMP%]{flex:1;position:relative;display:flex;justify-content:center;align-items:center;overflow:hidden}.image-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;max-height:100%;object-fit:contain}.feedback[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:2rem;font-weight:700;text-shadow:0 0 10px #000;pointer-events:none;opacity:0;transition:opacity .2s ease}.feedback.visible[_ngcontent-%COMP%]{opacity:1}.feedback.correct[_ngcontent-%COMP%]{color:#32cd32}.feedback.wrong[_ngcontent-%COMP%]{color:red}.loader-spinner[_ngcontent-%COMP%]{width:48px;height:48px;border:5px solid #f3f3f3;border-top:5px solid #f8d24b;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.bottom-controls[_ngcontent-%COMP%]{flex-shrink:0;padding:10px 14px 16px;background:#0000008c;backdrop-filter:blur(10px);border-top:1px solid rgba(248,210,75,.1333333333)}.guess[_ngcontent-%COMP%]{position:relative;width:100%}.guess[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]{width:100%;padding:11px 14px;border-radius:10px;border:1px solid rgba(248,210,75,.2);background:#1e1e28e6;color:#fff;font-size:1rem;box-sizing:border-box;font-family:inherit;box-shadow:0 0 5px #f8d24b22 inset}.suggestions[_ngcontent-%COMP%]{position:absolute;bottom:calc(100% + 6px);top:auto;left:0;width:100%;max-height:180px;overflow-y:auto;background:#14141e;border-radius:10px;border:1px solid rgba(248,210,75,.2);box-shadow:0 0 10px #f8d24b22;z-index:100}.suggestions[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.suggestions[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#1a1d22;border-radius:6px}.suggestions[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:linear-gradient(180deg,#f8d24b,#cea923);border-radius:6px}.suggestions[_ngcontent-%COMP%]   .suggestion-item[_ngcontent-%COMP%]{padding:10px 12px;cursor:pointer;border-radius:6px;transition:background .15s ease;color:#e5e7eb;border:1px solid transparent}.suggestions[_ngcontent-%COMP%]   .suggestion-item[_ngcontent-%COMP%]:active{background:#463806}.suggestions[_ngcontent-%COMP%]   .suggestion-item.focused[_ngcontent-%COMP%]{background:#645008;border-color:#f8d24b;color:#fff;box-shadow:0 0 8px #b9a91a99}.bottom-actions[_ngcontent-%COMP%]{display:flex;gap:10px;margin-top:10px}#skip-current-champ[_ngcontent-%COMP%]{flex:1;background:#f8d24b;color:#111;font-weight:700;border:none;border-radius:10px;padding:11px 16px;cursor:pointer;transition:all .2s ease;font-family:inherit;font-size:.95rem}#skip-current-champ[_ngcontent-%COMP%]:active{transform:scale(.97)}.history-btn[_ngcontent-%COMP%]{background:transparent;color:#f8d24b;border:1px solid #f8d24b;border-radius:10px;padding:11px 14px;cursor:pointer;font-family:inherit;font-size:.9rem;transition:background .2s ease;white-space:nowrap}.history-btn[_ngcontent-%COMP%]:active{background:#f8d24b22}.history-drawer[_ngcontent-%COMP%]{position:fixed;bottom:0;left:0;right:0;background:#13131f;border-top:2px solid rgba(248,210,75,.2666666667);border-radius:20px 20px 0 0;padding:16px 16px 28px;max-height:60vh;overflow-y:auto;transform:translateY(100%);transition:transform .3s cubic-bezier(.4,0,.2,1);z-index:300}.history-drawer.open[_ngcontent-%COMP%]{transform:translateY(0)}.history-drawer[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0;font-size:.95rem;text-align:left}.history-drawer[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:8px 0;border-bottom:1px solid rgba(248,210,75,.0666666667)}.history-drawer[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li.correct[_ngcontent-%COMP%]{color:#32cd32}.history-drawer[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li.wrong[_ngcontent-%COMP%]{color:#ff6b6b}.drawer-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}.drawer-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#f8d24b;margin:0;font-size:1.1rem}.drawer-close[_ngcontent-%COMP%]{background:transparent;border:none;color:#fff;font-size:1.2rem;cursor:pointer;padding:4px 8px}.drawer-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0009;opacity:0;pointer-events:none;transition:opacity .3s ease;z-index:299}.drawer-backdrop.visible[_ngcontent-%COMP%]{opacity:1;pointer-events:all}@media (min-width: 769px){.container[_ngcontent-%COMP%]{height:auto;min-height:100vh;overflow:visible;padding:0 20px;align-items:center;position:relative}.top-bar[_ngcontent-%COMP%]{background:transparent;backdrop-filter:none;border:none;padding:20px 0 0;width:100%;position:relative;justify-content:center}.top-bar[_ngcontent-%COMP%]   .stats-inline[_ngcontent-%COMP%]{display:none}.back-btn[_ngcontent-%COMP%]{position:absolute;left:0;padding:10px 20px}.back-btn[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:16px;height:12px}.back-btn[_ngcontent-%COMP%]:hover{background-color:#ffd85c;transform:scale(1.05);cursor:url(/assets/cursors/cursor_red.png),auto}.mode-title[_ngcontent-%COMP%]{font-size:1.3rem}.game-area[_ngcontent-%COMP%]{width:100%;max-width:1200px;gap:40px;align-items:flex-start;margin:20px auto;justify-content:center}.side-panel[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:200px;color:#f8d24b;align-items:center}.stats-panel[_ngcontent-%COMP%]{gap:20px;padding:20px 10px;background:linear-gradient(135deg,#1a1a1a,#0d0d0d);border-radius:15px;border:1px solid #444}.timer-block[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.timer-label[_ngcontent-%COMP%]{font-size:1rem;opacity:.8}.timer-value[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;margin-top:5px;font-family:monospace}.stats-block[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:12px}.stat-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:1rem}.stat-value[_ngcontent-%COMP%]{font-weight:700}.history-panel[_ngcontent-%COMP%]   .history[_ngcontent-%COMP%]{width:100%;background:#14141ecc;border:1px solid rgba(248,210,75,.2);border-radius:10px;padding:10px;max-height:300px;overflow-y:auto;box-shadow:0 0 10px #f8d24b22}.history-panel[_ngcontent-%COMP%]   .history[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1rem;color:#f8d24b;margin:0 0 8px;text-align:center}.history-panel[_ngcontent-%COMP%]   .history[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0;font-size:.9rem;text-align:left}.history-panel[_ngcontent-%COMP%]   .history[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{border-bottom:1px solid rgba(248,210,75,.1333333333);padding:4px 0}.history-panel[_ngcontent-%COMP%]   .history[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li.correct[_ngcontent-%COMP%]{color:#32cd32}.history-panel[_ngcontent-%COMP%]   .history[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li.wrong[_ngcontent-%COMP%]{color:#ff6b6b}.image-container[_ngcontent-%COMP%]{min-width:300px;min-height:300px;border:2px solid rgba(248,210,75,.2);border-radius:20px;background:#14141eb3;box-shadow:0 0 20px #f8d24b22}.image-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:15px}.bottom-controls[_ngcontent-%COMP%]{background:transparent;backdrop-filter:none;border:none;padding:0;width:100%;max-width:400px;margin:0 auto 20px}.bottom-actions[_ngcontent-%COMP%]{justify-content:center}.history-btn[_ngcontent-%COMP%], .history-drawer[_ngcontent-%COMP%], .drawer-backdrop[_ngcontent-%COMP%]{display:none}.suggestions[_ngcontent-%COMP%]{top:calc(100% + 4px);bottom:auto}#skip-current-champ[_ngcontent-%COMP%]{flex:none}#skip-current-champ[_ngcontent-%COMP%]:hover{background:#ffd85c;transform:scale(1.05);cursor:url(/assets/cursors/cursor_red.png),auto}}"]})};export{W as GameComponent};
