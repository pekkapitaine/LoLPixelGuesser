<div class="container">

  <!-- Top bar : back + titre + stats compactes -->
  <header class="top-bar">
    <button class="back-btn" (click)="goBack()">
      <img src="assets/interface/back_arrow.svg" alt="Retour">
    </button>
    <h2 class="mode-title">â™¾ï¸ Mode Infini â€” {{ difficultyTitle() }}</h2>
    <div class="stats-inline">
      <span>â±ï¸ {{ formattedTime() }}</span>
      <span>âœ… {{ stats().correct }}</span>
      <span>ğŸ”¥ {{ stats().streak }}</span>
    </div>
  </header>

  <!-- Zone principale -->
  <div class="game-area">

    <!-- Panneau stats (desktop uniquement) -->
    <aside class="side-panel stats-panel">
      <div class="timer-block">
        <div class="timer-label">â±ï¸ Temps</div>
        <div class="timer-value">{{ formattedTime() }}</div>
      </div>
      <div class="stats-block">
        <div class="stat-row">
          <span class="stat-label">ğŸ” Tentatives :</span>
          <span class="stat-value">{{ stats().attempts }}</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">âœ… Bons :</span>
          <span class="stat-value">{{ stats().correct }}</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">ğŸ”¥ SÃ©rie :</span>
          <span class="stat-value">{{ stats().streak }}</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">ğŸ“Š Ratio :</span>
          <span class="stat-value">{{ ratio() }} / min</span>
        </div>
      </div>
    </aside>

    <!-- Image champion -->
    <div class="image-container">
      @if (isLoading()) {
        <div class="loader-spinner"></div>
      } @else {
        <img [src]="champImageSrc()" alt="Champion PixelisÃ©">
      }
      <div class="feedback" [class.visible]="feedback() !== 'none'" [class.correct]="feedback() === 'correct'" [class.wrong]="feedback() === 'wrong'">
        {{ feedback() === 'correct' ? 'âœ… Correct !' : 'âŒ Faux !' }}
      </div>
    </div>

    <!-- Panneau historique (desktop uniquement) -->
    <aside class="side-panel history-panel">
      <div class="history">
        <h3>Historique</h3>
        <ul>
          @for (entry of history(); track $index) {
            <li [class.correct]="entry.correct" [class.wrong]="!entry.correct">
              {{ entry.correct ? 'âœ…' : 'âŒ' }} {{ entry.champion }}
            </li>
          }
        </ul>
      </div>
    </aside>

  </div>

  <!-- ContrÃ´les bas de page -->
  <div class="bottom-controls">
    <div class="guess">
      <input
        #champInput
        type="text"
        [value]="inputValue()"
        (input)="onInputChange($any($event.target).value)"
        (keydown)="onKeydown($event)"
        placeholder="Tape le nom du champion..."
        autocomplete="off"
      >
      @if (suggestions().length > 0) {
        <div class="suggestions">
          @for (suggestion of suggestions(); track suggestion; let i = $index) {
            <div
              class="suggestion-item"
              [class.focused]="i === focusedIndex()"
              (click)="selectSuggestion(suggestion)"
            >{{ suggestion }}</div>
          }
        </div>
      }
    </div>
    <div class="bottom-actions">
      <button id="skip-current-champ" (click)="skip()">Passer</button>
      <button class="history-btn" (click)="toggleHistory()">ğŸ“‹ Historique</button>
    </div>
  </div>

  <!-- Drawer historique (mobile) -->
  <div class="history-drawer" [class.open]="showHistory()">
    <div class="drawer-header">
      <h3>Historique</h3>
      <button class="drawer-close" (click)="toggleHistory()">âœ•</button>
    </div>
    <ul>
      @for (entry of history(); track $index) {
        <li [class.correct]="entry.correct" [class.wrong]="!entry.correct">
          {{ entry.correct ? 'âœ…' : 'âŒ' }} {{ entry.champion }}
        </li>
      }
    </ul>
  </div>
  <div class="drawer-backdrop" [class.visible]="showHistory()" (click)="toggleHistory()"></div>

</div>
